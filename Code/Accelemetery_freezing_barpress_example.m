%%Load 3-Axis data - Make example with a different rat
rawdata2 = cell(1, 3);
for i=1:3

    [rawdata2{:,i}, timestamps] = load_open_ephys_data(['100_AUX', num2str(i),'.continuous']);
  
end
rawdata = cell2mat(rawdata2);
data_len = size(rawdata, 1); 
%% Convert 3 axis voltage to accel
Acc = sqrt(rawdata(:,1).^2+rawdata(:,2).^2+rawdata(:,3).^2);
%% resample Accel at 10 samples/second
t_start = min(timestamps);
t_start_rnd = round(t_start,1);
Acc_rs = resample(Acc,1,3000);
time_new = (0:length(Acc_rs)-1)/10+t_start_rnd ;
time_rs = time_new';
time_rs = round(time_rs,1);
rs_min = min(Acc_rs);
Acc_new = Acc_rs - rs_min;
%% find difference between Accel points
diffAcc = abs(Acc_new(2:end)-Acc_new(1:end-1));
diffAcc(length(diffAcc)+1,1) = diffAcc(end);
%% Load events
[events, timepoints, info] = load_open_ephys_data(['all_channels.events']);
A=[];
A(:,1)=timepoints;
A(:,2)=events;
%%
Tone=A(find(A(:,2)==0)); 
Tone_rnd = round(Tone,1);

%% kernel barpress and smooth for correlation
BP=A(find(A(:,2)==4)); % 4 is a press event
BP_rnd = round(BP,1);
bar_press_binned = zeros(1,length(time_rs));
for b = 1:length(bar_press_binned)
    bar_press_binned(:,b) = numel(find(BP_rnd(:,:) == time_rs(b,:)));
end
presses = bar_press_binned';
bp_smooth = smoothdata(presses,'gaussian',70);

%% Freezing Data - Formating data 
load('HabConFreezingScore.mat')
load('HabConFreezingTime.mat')
FSn = table2array(HabConFreezingScore); 
FTn = table2array(HabConFreezingTime); 
FTa = FTn * 10^5; 
rtd = FTa < 3;
FSn(rtd) = [];
FTa(rtd) = [];
FTb = rmmissing(FTa);
FSb = rmmissing(FSn);
%% Resample Freezing Score/Time
FT_start = min(FTb);
FS_rs = resample(FSb,2,5);
FT_new = (0:numel(FS_rs)-1)/10+FT_start;
FT_rnd = round(FT_new,1);
FT_rs = FT_rnd';
%% Trim freezing data 30s before 1st tone and after 6th tone (recall)
% Recall_tone = [181 211 425 455 597 627 838 868 1104 1134 1229 1259];
% Extinction_tone = [200 230 357 387 619 649 720 750 983 1013 1204 1234 ...
%     1307 1337 1605 1635 1767 1797 2079 2109 2186 2216 2513 2543 2720 2750 ...
%     2857 2887 3020 3050 3166 3196 3429 3459 3711 3741 3869 3899 4170 4200];    
HabCon_tone = [221 251 431 461 526 556 770 800 1020 1050 1257 1287 1467 1497 ...
    1636 1666 1848 1878 2139 2169 2240 2270 2490 2520];
R_tone = HabCon_tone'; % Change second part (HabCon) to whatever phase is being analyzed
R_tone = round(R_tone,1);
fs_trim_start = min(R_tone) - 30;
[maxtonetime,maxtoneindex] = max(R_tone);
fs_trim_end = R_tone(maxtoneindex,:) + 30; 
rtd_f = FT_rs < fs_trim_start | FT_rs > fs_trim_end;
FS_rs(rtd_f) = [];
FT_rs(rtd_f) = [];
R_tone = R_tone - min(FT_rs);
FT_zero = round(FT_rs - min(FT_rs),1);
%% Trim accel and bp data 30s before first tone and 30s after last tone
trim_start = min(Tone_rnd) - 30;
trim_end = Tone_rnd(maxtoneindex,:) + 30; 
rtd_a = time_rs < trim_start | time_rs > trim_end; 
Acc_new(rtd_a) = [];
diffAcc(rtd_a) = [];
time_rs(rtd_a) = [];
bp_smooth(rtd_a) = [];
rtd_t = Tone_rnd > trim_end;
Tone_rnd(rtd_t) = [];
Tone_rnd = Tone_rnd - min(time_rs);
time_zero = round(time_rs - min(time_rs),1); %first tone should start at 30
catdata = padcat(time_zero,FS_rs,FT_rs,Acc_new,diffAcc,bp_smooth);
bp_smooth = catdata(:,6);
Acc_new = catdata(:,4);
%% Gaussian Smooth
acc_diff_smoothed = smoothdata(catdata(:,5),'gaussian',60);
acc_smoothed = smoothdata(catdata(:,4),'gaussian',60);
fs_smoothed = smoothdata(catdata(:,2),'gaussian',60);

%% Events per tone
tone_accel = zeros(1,(maxtoneindex/2)); %second parenth is number of tones
for j = 1:length(tone_accel)
    tone_accel(:,j) = mean(acc_diff_smoothed(find(time_zero >= Tone_rnd(2*j-1,:) & time_zero <= Tone_rnd(2*j,:))));
end
        
tone_freezing = zeros(1,(maxtoneindex/2));
for j = 1:length(tone_freezing)
    tone_freezing(:,j) = mean(fs_smoothed(find(time_zero >= Tone_rnd(2*j-1,:) & time_zero <= Tone_rnd(2*j,:))));
end

tone_press = zeros(1,(maxtoneindex/2));
for j = 1:length(tone_press)
    tone_press(:,j) = mean(bp_smooth(find(time_zero >= Tone_rnd(2*j-1,:) & time_zero <= Tone_rnd(2*j,:))));
end

tone_x = 1:(maxtoneindex/2);

%% Shifting Data &save best lag and circshift
% smoothed bar press & smoothed freezing score
[r_s_fs_bp,lags_s] = xcorr(bp_smooth,fs_smoothed,20,'coeff');
[Ma,Ia] = max(r_s_fs_bp);
best_lag_fs_bp = lags_s(:,Ia); 
shift_fs_bp = circshift(fs_smoothed,best_lag_fs_bp); 

% smoothed acceleration and smoothed freezing score
[r_s_fs_acc,lags_s_fs_acc] = xcorr(acc_smoothed,fs_smoothed,20,'coeff'); 
[Mb,Ib] = max(r_s_fs_acc);
best_lag_fs_acc = lags_s_fs_acc(:,Ib);
shift_fs_acc = circshift(fs_smoothed,best_lag_fs_acc);

% smoothed difference in acceleration and smoothed freezing score
[r_s_fs_diff,lags_s_fs_diff] = xcorr(acc_diff_smoothed,fs_smoothed,20,'coeff'); 
[Mc,Ic] = max(r_s_fs_diff);
best_lag_fs_diff = lags_s_fs_diff(:,Ic);
shift_fs_diff = circshift(fs_smoothed,best_lag_fs_diff);

% smoothed acceleration and smoothed bar press
[r_s_bp_acc,lags_s_bp_acc] = xcorr(acc_smoothed,bp_smooth,20,'coeff'); 
[Md,Id] = max(r_s_bp_acc);
best_lag_bp_acc = lags_s_bp_acc(:,Id);
shift_bp_acc = circshift(bp_smooth,best_lag_bp_acc); 

% smoothed difference in acceleration and smoothed bar press
[r_s_bp_diff,lags_s_bp_diff] = xcorr(acc_diff_smoothed,bp_smooth,20,'coeff'); 
[Me,Ie] = max(r_s_bp_diff);
best_lag_bp_diff = lags_s_bp_diff(:,Ie);
shift_bp_diff = circshift(bp_smooth,best_lag_bp_diff); 

%% Raw Correlations
%pre FS/Acc smoothing
[rho_bp_fs,p_bp_fs] = corr(bp_smooth,FS_rs,'Rows','complete');
r_bp_fs = rho_bp_fs^2;

[rho_acc_fs,p_acc_fs] = corr(catdata(:,4),FS_rs,'Rows','complete');
r_acc_fs = rho_acc_fs^2;

[rho_diff_fs,p_diff_fs] = corr(catdata(:,5),FS_rs,'Rows','complete');
r_diff_fs = rho_diff_fs^2;

[rho_diff_bp,p_diff_bp] = corr(catdata(:,5),bp_smooth,'Rows','complete'); 
r_diff_bp = rho_diff_bp^2; 

[rho_acc_bp,p_acc_bp] = corr(catdata(:,4),bp_smooth,'Rows','complete');
r_acc_bp = rho_acc_bp^2;

%% Smoothed Correlation
[rho_acc_fs_smooth,p_acc_fs_smooth] = corr(acc_smoothed,fs_smoothed,'Rows','complete');
r_acc_fs_smooth = rho_acc_fs_smooth^2;

[rho_diff_fs_smooth,p_diff_fs_smooth] = corr(acc_diff_smoothed,fs_smoothed,'Rows','complete');
r_diff_fs_smooth = rho_diff_fs_smooth^2;

[rho_acc_bp_smooth,p_acc_bp_smooth] = corr(acc_smoothed,bp_smooth,'Rows','complete');
r_acc_bp_smooth = rho_acc_bp_smooth^2;

[rho_diff_bp_smooth,p_diff_bp_smooth] = corr(acc_diff_smoothed,bp_smooth,'Rows','complete');
r_diff_bp_smooth = rho_diff_bp_smooth^2;

[rho_fs_bp_smooth,p_fs_bp_smooth] = corr(fs_smoothed,bp_smooth,'Rows','complete');
r_fs_bp_smooth = rho_fs_bp_smooth^2;


%% Shifted Correlation (all with smoothed data)

[rho_shift_fs_bp,p_shift_fs_bp] = corr(bp_smooth,shift_fs_bp,'Rows','complete');
r_shift_fs_bp = rho_shift_fs_bp^2;

[rho_shift_fs_acc,p_shift_fs_acc] = corr(acc_smoothed,shift_fs_acc,'Rows','complete');
r_shift_fs_acc = rho_shift_fs_acc^2;

[rho_shift_fs_diff,p_shift_fs_diff] = corr(acc_diff_smoothed,shift_fs_diff,'Rows','complete');
r_shift_fs_diff = rho_shift_fs_diff^2;

[rho_shift_bp_acc,p_shift_bp_acc] = corr(acc_smoothed,shift_bp_acc,'Rows','complete');
r_shift_bp_acc = rho_shift_bp_acc^2;

[rho_shift_bp_diff,p_shift_bp_diff] = corr(acc_diff_smoothed,shift_bp_diff,'Rows','complete');
r_shift_bp_diff = rho_shift_bp_diff^2;

%% Shift Correction
[r_s_fs_diff,lags_s_fs_diff] = xcorr(acc_diff_smoothed,fs_smoothed,20,'coeff');

tones = 12;

for i = 1:tones
    Shifted_accel_data(i,:) = circshift(acc_diff_smoothed,(300 * i)); 
    [acc_fs_cross_correlations(i,:),lags] = xcorr(Shifted_accel_data(i,:),fs_smoothed,20,'coeff');
end

mean_all_cross_correlations = mean(acc_fs_cross_correlations,1);

mean_all_cross_correlations = mean_all_cross_correlations';
corrected_cross_correlation = r_s_fs_diff - mean_all_cross_correlations;

best_lag = lags(:,find(corrected_cross_correlation == max(corrected_cross_correlation)));

%% Normalizing data from 0-1
acc_norm = mat2gray(acc_diff_smoothed);
bp_norm = mat2gray(bp_smooth);
fs_norm = mat2gray(fs_smoothed);

%% Thresholding accelerometry
threshold = .09;% set based on comparable freezing score threshold

Accelerometer_Freezing = acc_norm(:,:) <= threshold;

tone_accel_freezing = zeros(1,12); 

for j = 1:12 % 6 being the number of tones in recall
    tone_accel_freezing(1,j) = ((sum(Accelerometer_Freezing(find(time_zero >= Tone_rnd(2*j-1,:) & time_zero <= Tone_rnd(2*j,:)))))/(length(find(time_zero >= Tone_rnd(2*j-1,:) & time_zero < Tone_rnd(2*j,:)))))*100;
end

%% Main Text Plots
%% Figure 1c
load('main_plot_data.mat');
r = 5;

figure;
plot(tone_x(:,1:5),tones_bp_norm(r,1:5),'-o',...
    'Color',[0 0 1],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',7);
ylabel('Normalized Score')
ylim([0 1.1])
hold on

xticks([1 3 5 6 8 10 12 13 15 17 19 21 23 25 27 29 31 33 35 37])
xticklabels({1 3 5 1 3 5 7 1 3 5 7 9 11 13 15 17 19 1 3 5});
 
plot(tone_x(:,1:5),tones_acc_norm(r,1:5),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',7);

plot(tone_x(:,1:5),tones_fs_norm(r,1:5),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',7);

plot(tone_x(:,6:12),tones_bp_norm(r,6:12),'-o',...
    'Color',[0 0 1],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',7);
plot(tone_x(:,13:32),tones_bp_norm(r,13:32),'-o',...
    'Color',[0 0 1],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',7);
plot(tone_x(:,33:38),tones_bp_norm(r,33:38),'-o',...
    'Color',[0 0 1],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',7);
%
plot(tone_x(:,6:12),tones_fs_norm(r,6:12),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',7);
plot(tone_x(:,13:32),tones_fs_norm(r,13:32),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',7);
plot(tone_x(:,33:38),tones_fs_norm(r,33:38),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',7);
%
plot(tone_x(:,6:12),tones_acc_norm(r,6:12),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',7);
plot(tone_x(:,13:32),tones_acc_norm(r,13:32),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',7);
plot(tone_x(:,33:38),tones_acc_norm(r,33:38),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',5,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',7);

xline(5.5,'--','LineWidth',5,'Color','k')
xline(12.5,'--','LineWidth',5,'Color','k')
xline(32.5,'--','LineWidth',5,'Color','k')

t1 = text(2.5,1,'Hab');
t2 = text(8.75,1,'Con');
t3 = text(22,1,'Ext');
t4 = text(36,1,'Re');

legend({'Smoothed Bar Press','Smoothed Accelerometry Change','Smoothed Freezing Score'},'AutoUpdate','off');
%% Figure 1d
figure;
errorbar(tone_x(:,1:5),mean(tones_bp_norm(:,1:5)),tones_presses_norm_SEM(:,1:5),'-o',...
    'Color',[0 0 1],...
    'LineWidth',2,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',5);
%xlabel('Tone')
ylabel('Normalized Score')
ylim([-.2 1])
hold on

xticks([1 3 5 6 8 10 12 13 15 17 19 21 23 25 27 29 31 33 35 37])
xticklabels({1 3 5 1 3 5 7 1 3 5 7 9 11 13 15 17 19 1 3 5});
 
errorbar(tone_x(:,1:5),mean(tones_acc_norm(:,1:5)),tones_acc_norm_SEM(:,1:5),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',2,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',5);

errorbar(tone_x(:,1:5),mean(tones_fs_norm(:,1:5)),tones_fs_norm_SEM(:,1:5),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',5);


errorbar(tone_x(:,6:12),mean(tones_bp_norm(:,6:12)),tones_presses_norm_SEM(:,6:12),'-o',...
    'Color',[0 0 1],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',5);
errorbar(tone_x(:,13:32),mean(tones_bp_norm(:,13:32)),tones_presses_norm_SEM(:,13:32),'-o',...
    'Color',[0 0 1],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',5);
errorbar(tone_x(:,33:38),mean(tones_bp_norm(:,33:38)),tones_presses_norm_SEM(:,33:38),'-o',...
    'Color',[0 0 1],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',5);

%

errorbar(tone_x(:,6:12),mean(tones_fs_norm(:,6:12)),tones_fs_norm_SEM(:,6:12),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',5);
errorbar(tone_x(:,13:32),mean(tones_fs_norm(:,13:32)),tones_fs_norm_SEM(:,13:32),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',5);
errorbar(tone_x(:,33:38),mean(tones_fs_norm(:,33:38)),tones_fs_norm_SEM(:,33:38),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',5);

%
errorbar(tone_x(:,6:12),mean(tones_acc_norm(:,6:12)),tones_acc_norm_SEM(:,6:12),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',5);
errorbar(tone_x(:,13:32),mean(tones_acc_norm(:,13:32)),tones_acc_norm_SEM(:,13:32),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',5);
errorbar(tone_x(:,33:38),mean(tones_acc_norm(:,33:38)),tones_acc_norm_SEM(:,33:38),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',5);

xline(5.5,'--','LineWidth',2,'Color','k')
xline(12.5,'--','LineWidth',2,'Color','k')
xline(32.5,'--','LineWidth',2,'Color','k')

t1 = text(2.5,.98,'Hab');
t2 = text(8.75,.98,'Con');
t3 = text(22,.98,'Ext');
t4 = text(36,.98,'Re');

legend({'Smoothed Bar Press','Smoothed Accelerometry Change','Smoothed Freezing Score'},'AutoUpdate','off');
%% Figure 1e

figure;
scatter(tones_acc_norm,tones_bp_norm,[],...
    'LineWidth', 4) 
xlabel('Smoothed Acceleration Change')
ylabel('Smoothed Bar Press')
txt = ['r = ', num2str(ab_mean_tone_r)];
text(.05,1,txt,'FontSize',31);
%% Figure 2a
figure;
H = gca;
histogram(all_session_rat_lags,41,...
    'FaceColor','k',...
    'LineWidth',4);
xlabel('Lag (seconds)')
ylabel('Instances')
H.LineWidth = 4;
H.FontSize = 31;
H.TickLength = [0 0];
H.YLim = [0 40];
H.Box = 'off';
%% figure 2b
figure;
I = gca;
histogram(corrected_best_lag,41,...
    'FaceColor','k',...
    'LineWidth',4);
xlabel('Lag (seconds)')
ylabel('Instances')
I.LineWidth = 4;
I.FontSize = 31;
I.TickLength = [0 0];
I.Box = 'off';
%% Figure 3a 
figure;
plot(time_zero(9481:9881,:),bp_norm_ind(9481:9881,:),...
    'Color',[0 0 1],...
    'LineWidth',5);
xlim([950 986]) 
ylim([0 1])
xlabel('Time (seconds)')
ylabel('Normalized Score')
hold on

 
plot(time_zero(9481:9881,:),acc_norm_ind(9481:9881,:),...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',5);

plot(time_zero(9481:9881,:),fs_norm_ind(9481:9881,:),...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',5);


legend({'Smoothed Bar Press','Smoothed Accelerometry Change','Smoothed Freezing Score'},'AutoUpdate','off');


x = [953 983 983 953];
y = [-.3 -.3 1.3 1.3];   
patch(x,y,'red','FaceAlpha','.1')
 xline(953,'r','LineWidth',2)
 xline(983,'k','LineWidth',2)

%% Figure 3b-d
figure;
scatter(acc_norm(1000:1200,:),bp_norm(1000:1200,:),[],...
    'LineWidth', 4) 
xlabel('Smoothed Acceleration Change')
ylabel('Smoothed Bar Press')
title('Smoothed Acceleration Change vs Smoothed Bar Press')
txt = ['mean r: ', num2str(mean(mean_ab_norm_r))];
text(.7,.75,txt,'FontSize',31);
txtp = ['p-value: ', num2str(abp)];
text(.7,.715,txtp,'FontSize',31);

figure;
scatter(bp_norm(1000:1200,:),fs_norm(1000:1200,:),[],...
    'LineWidth',4) 
xlabel('Smoothed Bar Press')
ylabel('Smoothed Freezing Score')
title('Smoothed Freezing Score vs Smoothed Bar Press')
txt = ['mean r: ', num2str(mean(mean_fb_norm_r))];
text(.52,.76,txt,'FontSize',31);
txtp = ['p-value: ', num2str(bfsp)];
text(.52,.72,txtp,'FontSize',31);

figure;
scatter(acc_norm(1000:1200,:),fs_norm(1000:1200,:),[],...
    'LineWidth', 4) 
xlabel('Smoothed Acceleration Change')
ylabel('Smoothed Freezing Score')
title('Smoothed Acceleration Change vs Smoothed Freezing Score')
txt = ['mean r: ', num2str(mean(mean_fa_norm_r))];
text(.65,.8,txt,'FontSize',31);
txtp = ['p-value: ', num2str(afp)];
text(.65,.76,txtp,'FontSize',31); 
x = [1 2 3 4 5 6];
%% Figure 4 a and b
figure
x = [1 2 3 4 5 6 7];
f = boxplot(All_facccorr_mean,'Labels',{'R','RC','S','SC','SSh','SCSh','SCN'},...
    'Colors','k',...
    'symbol','');
set(f,{'linew'},{4});
xlabel('Method','fontsize',31)
ylabel('r^2','fontsize',31)
title('Freezing x Acceleration','fontsize',31)
hold on
scatter(x,All_facccorr_mean,...
    'MarkerEdgeColor', 'k', 'LineWidth',3)

figure
b = boxplot(All_bpacccorr_mean,'Labels',{'R','RC','S','SC','SSh','SCSh','SCN'},...
    'Colors','k',...
    'symbol','');
set(b,{'linew'},{4});
xlabel('Method','fontsize',31)
ylabel('r^2','fontsize',31)
title('Bar Press x Acceleration','fontsize',31)
hold on
scatter(x,All_bpacccorr_mean,...
    'MarkerEdgeColor', 'k','LineWidth',3)
%% Figure 5a
figure
errorbar(tone_x(:,1:5),mean(tones_bp_norm(:,1:5)),tones_presses_norm_SEM(:,1:5),'-o',...
    'Color',[0 0 1],...
    'LineWidth',2,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',5);
%xlabel('Tone')
ylabel('Normalized Score')
ylim([-.2 1])
hold on

xticks([1 3 5 6 8 10 12 13 15 17 19 21 23 25 27 29 31 33 35 37])
xticklabels({1 3 5 1 3 5 7 1 3 5 7 9 11 13 15 17 19 1 3 5});
 
errorbar(tone_x(:,1:5),mean(tone_accel_freezing_norm(:,1:5)),tone_accel_freezing_SEM(:,1:5),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',2,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',5);

errorbar(tone_x(:,1:5),mean(Percentfreezing_norm(:,1:5)),Percentfreezing_SEM(:,1:5),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',5);


errorbar(tone_x(:,6:12),mean(tones_bp_norm(:,6:12)),tones_presses_norm_SEM(:,6:12),'-o',...
    'Color',[0 0 1],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',5);
errorbar(tone_x(:,13:32),mean(tones_bp_norm(:,13:32)),tones_presses_norm_SEM(:,13:32),'-o',...
    'Color',[0 0 1],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',5);
errorbar(tone_x(:,33:38),mean(tones_bp_norm(:,33:38)),tones_presses_norm_SEM(:,33:38),'-o',...
    'Color',[0 0 1],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0 0 1],...
    'MarkerFaceColor',[0 0 1],...
    'MarkerSize',5);

%

errorbar(tone_x(:,6:12),mean(Percentfreezing_norm(:,6:12)),Percentfreezing_SEM(:,6:12),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',5);
errorbar(tone_x(:,13:32),mean(Percentfreezing_norm(:,13:32)),Percentfreezing_SEM(:,13:32),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',5);
errorbar(tone_x(:,33:38),mean(Percentfreezing_norm(:,33:38)),Percentfreezing_SEM(:,33:38),'-o',...
    'Color',[0.8500 0.3250 0.0980],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.8500 0.3250 0.0980],...
    'MarkerFaceColor',[0.8500 0.3250 0.0980],...
    'MarkerSize',5);

%
errorbar(tone_x(:,6:12),mean(tone_accel_freezing_norm(:,6:12)),tone_accel_freezing_SEM(:,6:12),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',5);
errorbar(tone_x(:,13:32),mean(tone_accel_freezing_norm(:,13:32)),tone_accel_freezing_SEM(:,13:32),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',5);
errorbar(tone_x(:,33:38),mean(tone_accel_freezing_norm(:,33:38)),tone_accel_freezing_SEM(:,33:38),'-o',...
    'Color',[0.4660 0.6740 0.1880],...
    'LineWidth',1.5,...
    'MarkerEdgeColor',[0.4660 0.6740 0.1880],...
    'MarkerFaceColor',[0.4660 0.6740 0.1880],...
    'MarkerSize',5);

xline(5.5,'--','LineWidth',2,'Color','k')
xline(12.5,'--','LineWidth',2,'Color','k')
xline(32.5,'--','LineWidth',2,'Color','k')

t1 = text(2.5,.98,'Hab');
t2 = text(8.75,.98,'Con');
t3 = text(22,.98,'Ext');
t4 = text(36,.98,'Re');

legend({'Binned Bar Press','Percent Freezing (Accelerometry)','Percent Freezing (Video)'},'AutoUpdate','off');
%% Figure 5b
figure
scatter(tone_accel_freezing_norm,Percentfreezing_norm,[],...
    'LineWidth', 4) 
xlabel('Percent Time Freezing (Accelerometry)')
ylabel('Percent Time Freezing (Video)')
title('Thresholded Accelerometry vs Percent Time Freezing Per Tone')
txt = ['r = ', num2str(af_mean_tone_r)];
text(0.03,0.9,txt,'FontSize',31);
